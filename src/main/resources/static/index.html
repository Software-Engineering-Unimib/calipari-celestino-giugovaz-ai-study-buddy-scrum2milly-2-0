<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard - AI Study Buddy</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">
  <link href="css/style.css" rel="stylesheet">
  <link href="css/topbar-footer.css" rel="stylesheet">
</head>
<body>
<!-- Sidebar, Topbar generati da layout.js -->

<main class="main-content">
  <!-- Topbar verrÃ  inserito qui da renderTopbar() -->

  <!-- Welcome Card -->
  <div class="card" style="background: var(--gradient-primary); border: none; margin-bottom: 1.5rem;">
    <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 1rem;">
      <div>
        <h2 style="font-size: 1.5rem; font-weight: 700; margin-bottom: 0.5rem;">
          Ciao, <span id="welcomeName">Studente</span>! ðŸ‘‹
        </h2>
        <p style="opacity: 0.9; margin: 0;">Pronto per una nuova sessione di studio?</p>
      </div>
      <a href="quiz.html" class="btn btn-secondary">
        <i class="bi bi-play-fill"></i> Inizia Quiz
      </a>
    </div>
  </div>

  <!-- Stats Grid -->
  <h3 class="page-title" style="font-size: 1.25rem; margin-bottom: 1rem;">
    <i class="bi bi-graph-up-arrow text-primary"></i> Le tue statistiche
  </h3>

  <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 2rem;">
    <div class="stat-card">
      <div class="card-icon primary"><i class="bi bi-lightning-charge-fill"></i></div>
      <div>
        <div class="stat-value" id="statXp">0</div>
        <div class="stat-label">XP Totali</div>
      </div>
    </div>
    <div class="stat-card">
      <div class="card-icon" style="background: #dc2626;"><i class="bi bi-fire"></i></div>
      <div>
        <div class="stat-value" id="statStreak">0</div>
        <div class="stat-label">Giorni Streak</div>
      </div>
    </div>
    <div class="stat-card">
      <div class="card-icon success"><i class="bi bi-patch-check-fill"></i></div>
      <div>
        <div class="stat-value" id="statQuiz">0</div>
        <div class="stat-label">Quiz Completati</div>
      </div>
    </div>
    <div class="stat-card">
      <div class="card-icon warning"><i class="bi bi-stack"></i></div>
      <div>
        <div class="stat-value" id="statFlashcards">0</div>
        <div class="stat-label">Flashcards</div>
      </div>
    </div>
  </div>

  <!-- Quick Actions -->
  <h3 class="page-title" style="font-size: 1.25rem; margin-bottom: 1rem;">
    <i class="bi bi-rocket-takeoff text-primary"></i> Azioni rapide
  </h3>

  <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 1rem;">
    <a href="explaination.html" class="card" style="text-decoration: none; text-align: center; padding: 1.5rem;">
      <i class="bi bi-lightbulb text-warning" style="font-size: 2.5rem; display: block; margin-bottom: 0.75rem;"></i>
      <strong style="color: #fff;">Chiedi Spiegazione</strong>
      <small style="display: block; color: var(--text-muted);">+10 XP</small>
    </a>
    <a href="quiz.html" class="card" style="text-decoration: none; text-align: center; padding: 1.5rem;">
      <i class="bi bi-patch-question text-primary" style="font-size: 2.5rem; display: block; margin-bottom: 0.75rem;"></i>
      <strong style="color: #fff;">Genera Quiz</strong>
      <small style="display: block; color: var(--text-muted);">+20 XP</small>
    </a>
    <a href="flashcards.html" class="card" style="text-decoration: none; text-align: center; padding: 1.5rem;">
      <i class="bi bi-stack text-success" style="font-size: 2.5rem; display: block; margin-bottom: 0.75rem;"></i>
      <strong style="color: #fff;">Studia Flashcards</strong>
      <small style="display: block; color: var(--text-muted);">+5 XP/carta</small>
    </a>
    <a href="leaderboard.html" class="card" style="text-decoration: none; text-align: center; padding: 1.5rem;">
      <i class="bi bi-trophy text-danger" style="font-size: 2.5rem; display: block; margin-bottom: 0.75rem;"></i>
      <strong style="color: #fff;">Classifica</strong>
      <small style="display: block; color: var(--text-muted);">Vedi posizione</small>
    </a>
  </div>

  <!-- Footer verrÃ  aggiunto da renderFooter() -->
</main>

<script src="js/layout.js"></script>
<script>
  document.addEventListener('DOMContentLoaded', function() {
      // Inizializza layout (sidebar + topbar + footer)
      initLayout({
          pageTitle: 'Dashboard',
          activePage: 'index',
          showTopbar: true,
          showFooter: true
      });

      // Carica dati dashboard
      loadDashboardData();
  });

  async function loadDashboardData() {
      // Nome utente
      const user = JSON.parse(localStorage.getItem('user') || '{}');
      const welcomeEl = document.getElementById('welcomeName');
      if (welcomeEl && user.firstName) {
          welcomeEl.textContent = user.firstName;
      }

      // Statistiche
      try {
          const token = localStorage.getItem('token');
          if (!token) return;

          const response = await fetch('/api/gamification/stats', {
              headers: { 'Authorization': `Bearer ${token}` }
          });

          if (response.ok) {
              const stats = await response.json();
              document.getElementById('statXp').textContent = (stats.totalXp || 0).toLocaleString();
              document.getElementById('statStreak').textContent = stats.currentStreak || 0;
              document.getElementById('statQuiz').textContent = stats.quizzesCompleted || 0;
              document.getElementById('statFlashcards').textContent = stats.flashcardsStudied || 0;
          }
      } catch (error) {
          console.error('Errore caricamento stats:', error);
      }
  }
</script>
</body>
</html>